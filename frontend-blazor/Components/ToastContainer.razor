@using NeonGadgetStore.Web.Services
@inject ToastService ToastService
@implements IDisposable

<div class="toast-container">
    @foreach (var toast in _toasts)
    {
        <div class="toast @GetToastClass(toast.Type)">
            <div class="flex items-start gap-3">
                <div class="flex-shrink-0">
                    @if (toast.Type == ToastType.Success)
                    {
                        <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    }
                    else if (toast.Type == ToastType.Error)
                    {
                        <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    }
                    else
                    {
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    }
                </div>
                <div class="flex-1">
                    <h4 class="font-semibold text-sm">@toast.Title</h4>
                    @if (!string.IsNullOrEmpty(toast.Message))
                    {
                        <p class="text-sm text-muted-foreground">@toast.Message</p>
                    }
                </div>
                <button @onclick="() => RemoveToast(toast.Id)" class="flex-shrink-0 text-muted-foreground hover:text-foreground">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    }
</div>

@code {
    private List<ToastMessage> _toasts = new();

    protected override void OnInitialized()
    {
        ToastService.OnShow += ShowToast;
        ToastService.OnHide += RemoveToast;
    }

    private void ShowToast(ToastMessage toast)
    {
        _toasts.Add(toast);
        StateHasChanged();

        // Auto-remove after 5 seconds
        Task.Run(async () =>
        {
            await Task.Delay(5000);
            await InvokeAsync(() =>
            {
                RemoveToast(toast.Id);
            });
        });
    }

    private void RemoveToast(Guid id)
    {
        var toast = _toasts.FirstOrDefault(t => t.Id == id);
        if (toast != null)
        {
            _toasts.Remove(toast);
            StateHasChanged();
        }
    }

    private string GetToastClass(ToastType type)
    {
        return type switch
        {
            ToastType.Success => "toast-success",
            ToastType.Error => "toast-error",
            _ => ""
        };
    }

    public void Dispose()
    {
        ToastService.OnShow -= ShowToast;
        ToastService.OnHide -= RemoveToast;
    }
}
