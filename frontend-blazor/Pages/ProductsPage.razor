@page "/products"
@using NeonGadgetStore.Web.Models
@using NeonGadgetStore.Web.Services
@using NeonGadgetStore.Web.Components
@inject ApiService ApiService

<PageTitle>All Products - ElectroHub</PageTitle>

<div class="min-h-screen pt-24 pb-20">
    <div class="container mx-auto px-4">
        <!-- Header -->
        <div class="mb-12">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">All Products</h1>
            <p class="text-lg text-muted-foreground max-w-2xl">
                Browse our complete collection of premium electronics and gadgets
            </p>
        </div>

        <!-- Loading State -->
        @if (_isLoading)
        {
            <div class="text-center py-20">
                <div class="animate-spin w-16 h-16 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"></div>
                <p class="text-muted-foreground text-lg">Loading products...</p>
            </div>
        }
        <!-- Products Grid -->
        else if (_allProducts.Any())
        {
            <div class="mb-6 flex items-center justify-between">
                <p class="text-muted-foreground">
                    Showing <span class="font-semibold text-foreground">@_allProducts.Count</span> products
                </p>
                <div class="flex gap-2">
                    <select @onchange="HandleSortChange" class="form-input px-4 py-2 rounded-lg bg-card border border-border text-sm">
                        <option value="">Sort by</option>
                        <option value="name">Name (A-Z)</option>
                        <option value="price-low">Price (Low to High)</option>
                        <option value="price-high">Price (High to Low)</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                @foreach (var product in _allProducts)
                {
                    <ProductCard Product="product" />
                }
            </div>
        }
        <!-- Empty State -->
        else
        {
            <div class="text-center py-20">
                <svg class="w-32 h-32 mx-auto text-muted-foreground/30 mb-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                </svg>
                <h2 class="text-2xl font-semibold mb-4">No products available</h2>
                <p class="text-muted-foreground mb-8">Check back soon for new products</p>
                <a href="/" class="btn btn-primary rounded-lg">Back to Home</a>
            </div>
        }
    </div>
</div>

<Footer />

@code {
    private List<Product> _allProducts = new();
    private bool _isLoading = true;
    private string? _sortBy;

    protected override async Task OnInitializedAsync()
    {
        _isLoading = true;
        _allProducts = await ApiService.GetProductsAsync();
        _isLoading = false;
    }

    private void HandleSortChange(ChangeEventArgs e)
    {
        _sortBy = e.Value?.ToString();
        
        _allProducts = _sortBy switch
        {
            "name" => _allProducts.OrderBy(p => p.Name).ToList(),
            "price-low" => _allProducts.OrderBy(p => p.Price).ToList(),
            "price-high" => _allProducts.OrderByDescending(p => p.Price).ToList(),
            _ => _allProducts
        };
    }
}
